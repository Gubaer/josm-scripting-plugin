<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>JOSM Scripting Plugin by Gubaer</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeRDark.css" rel="stylesheet" type="text/css" />
	<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
	<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJScript.js" type="text/javascript"></script>
	<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shAutoloader.js" type="text/javascript"></script>
    
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/Gubaer/josm-scripting-plugin">View On GitHub</a></li>
          <li class="downloads"><a href="index.html#install">Install</a></li>
          <li class="title">INSTALL</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">
    <section>

<h1>Working with Nodes</h1>

<p>The scripting plugin is working with JOSMs implementation of an OSM node, i.e. with the 
class
<a href="http://josm.openstreetmap.de/browser/josm/trunk/src/org/openstreetmap/josm/data/osm/Node.java">org.openstreetmap.josm.data.osm.Node</a>.</p>
 

<p>For convenience, the scripting plugin extends <code>Node</code> instances with additional JavaScript properties
and methods. In addition to the native Java methods the properties and methods provided by
<a href="NodeMixin">NodeMixin</a> are available for Node instances.</p>
 
 
<script type="syntaxhighlighter" class="brush:js"><![CDATA[
var node = ...;  // create or lookup a node

// ** Example 1 **
// use a native java setter method ...
node.setCoor(new LatLon(12.3,67.22));
// ... or a property provided by NodeMixin
node.pos = {lat: 12.3, lon: 67.22};

// ** Example 2 **
// use a native getter method and the native method east().	
// Note the '$'-prefix. You can prefix any native java method name with '$' if there
// is a name conflict with a property/method provided by a Javascript mixin.
// In this case a javascript property 'east' is defined for the java class
// EastNorth.
var east = node.getEastNorth().$east();

// ... or a property provided by NodeMixin
var east = node.eaast;
]]></script>

 
<h2 id="creating-nodes">Creating nodes</h2> 

<p>The scripting plugin includes a builder for OSM nodes. Here's a basis example:</p>

<script type="syntaxhighlighter" class="brush:js"><![CDATA[
var builder = require("josm/builder").NodeBuilder;
 
// this creates a new node with the global ID 12345
// at the position [0,0] with no tags
var node = builder.create(12345);
]]></script>

Here's an example how you can create Nodes using one of the native java constructors for 
Node.
<script type="syntaxhighlighter" class="brush:js"><![CDATA[
var Node = org.openstreetmap.josm.data.osm.Node;
var LatLon = org.openstreetmap.josm.data.coor.LatLon;
 
// this creates a new node with the global ID 12345.
// Note  that this constructor doesn't set the coordinates! 
// node.getCoor() would reply null.
var node = new Node(12345,1);
node.setCoor(new LatLon(0,0));
]]></script>

<h2>Local and global nodes</h2>
<p>OSM nodes have a lifecycle. They are created <strong>locally</strong> in a running JOSM instance. 
At this point, they get assigned a negative numeric id, which is automatically created by JOSM. 
You don't have to supply it. When a node is uploaded to the OSM database, it gets assigned a <strong>global</strong>
 id, i.e. positive numeric id assigned by the OSM server.</p>
 
<script type="syntaxhighlighter" class="brush:js"><![CDATA[
var builder = require("josm/builder").NodeBuilder;

// this creates a new local node. Don't supply a numeric ID, JOSM
// will create one.
var localNode = builder.create(); 

// this creates a new global node. You must supply 
// a positive numeric id (12345 in this example). 
var globalNode = builder.create(12345);
]]></script>

<h2>Initializing id and version</h2>
<p> A global OSM node has a positive numeric id and a version (a positive number, too).</p> 

<script type="syntaxhighlighter" class="brush:js"><![CDATA[
var builder = require("josm/builder").NodeBuilder;

// use a named argument for the version 
var n2 = builder.create(12345,{version: 5});

// ... or use method chaining in the builder object 
var n3 = builder.withId(12345, 5).create();

// if you omit the version, version 1 is assumed.
var n4 = builder.create(12345);
var n5 = builder.withId(12345).create();
]]></script>

<h2>Initializing  position</h2>
<p>A node has a position given by a latitude and a longitude. A latitude is a numeric value in 
the range [-90,90]. A longitude is a numeric value in the range [-180,180].</p>

<p>You can supply the position as named arguments to the <code>create</code> method or use method 
chaining with the method <code>withPosition</code>.

<script type="syntaxhighlighter" class="brush:js"><![CDATA[
var builder = require("josm/builder").NodeBuilder;

// creates a new local node at position [22.123, -65.543]
var n1 = builder.create({lat:22.123, lon: -65.543});

// ... using method chaining 
var n2 = builder.withPosition(22.123, -65.543).create();

// ... using the named argument 'pos' and an array of numbers 
var n1 = builder.create({pos:[22.123,-65.543]});

// ... using the named argument 'pos' and an object 
var n1 = builder.create({pos:{lat: 22.123,lon: -65.543}});

// ... using the named argument 'pos' and the built-in 
// LatLon object provided by JOSM
var LatLon = org.openstreetmap.josm.data.coor.LatLon;
var coor = new LatLon(22.123,-65.543);
var n1 = builder.create({pos: coor});
]]></script>

<h2>Initializing tags</h2>
<p>nodes can be assigned a set of key/value-pairs, so called <strong>tags</strong>.</p>

<p>You can supply tags as named arguments to the <code>create</code> method or use method 
chaining with the method <code>withTags</code>.

<script type="syntaxhighlighter" class="brush:js"><![CDATA[
var builder = require("josm/builder").NodeBuilder;

// creates a new local node with the tag amenity=restaurant and name=English Pub 
var n1 = builder.create({tags: {amenity: "restaurant", name: "English Pub"}} );

// creates a new local node with the tag amenity=restaurant and name=English Pub 
var n2 = builder.withTags({amenity: "restaurant", name: "English Pub"}).create();
]]></script>

<h2>Creating a proxy node</h2>
<p>Sometimes you just want to <em>refer</em> to a global OSM node without downloading all 
its details from the OSM server. In JOSM terminology this is called an <em>incomplete</em> node. Here
we use the term a <strong>proxy node</strong>.

<p>For a proxy node you only know its global id.</p> 

<script type="syntaxhighlighter" class="brush:js"><![CDATA[
var builder = require("josm/builder").NodeBuilder;

// creates a proxy node for the global node 98765
var proxy = builder.createProxy(98765);
]]></script>

<h2>Additional node properties</h2> 
<dl>
  <dt>id</dt> 
  <dd>(read-only) the unique numeric id<dd>
  
  <dt>version</dt>
  <dd>(read-only) the global version. <code>undefined</code> for local and proxy nodes.</dd>

  <dt>tags</dt>
  <dd>the tags objects. Assign null or undefined to remove all tags. 
  Use <code>tags.highway = "residential"</code>  or <code>tags["highway"] = "residential"</code> 
  to set a tag. Remove a tag using the javascript <code>delete</code> operator: <code>delete tags["highway"]</code>.</dd>
  
  <dt>lat</dt>
  <dd>the latitude of the node position. <code>undefined</code>c
   if the latitude isn't known (i.e. for a proxy node). 
   Set a valid latitude as numeric value. Any other value leads to an error. 
  </dd>

  <dt>lon</dt>
  <dd>the longitude of the node position. <code>undefined</code> if the longitude isn't known (i.e. for a proxy node). 
  Set a valid longitude as numeric value. Any other value leads to an error. 
  </dd>

  <dt>east</dt> 
  <dd>(read-only) the projected east-coordinate. <code>undefined</code> if unknown.</dd>
  
  <dt>north</dt> 
  <dd>(read-only) the projected north-coordinate. <code>undefined</code> if unknown.</dd>
</dl>


<script type="text/javascript">
    SyntaxHighlighter.all()
</script>

    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
        
  </body>
</html>
