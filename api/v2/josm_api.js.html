<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>JOSM Scripting Plugin - JavaScript API V2 Source: josm/api.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">JOSM Scripting Plugin - JavaScript API V2</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-clipboard.html">clipboard</a></li><li><a href="module-josm.html">josm</a></li><li><a href="module-josm_api.html">josm/api</a></li><li><a href="module-josm_builder.html">josm/builder</a></li><li><a href="module-josm_command.html">josm/command</a></li><li><a href="module-josm_ds.html">josm/ds</a></li><li><a href="module-josm_layers.html">josm/layers</a></li><li><a href="module-josm_scriptingconsole.html">josm/scriptingconsole</a></li><li><a href="module-josm_ui_menu.html">josm/ui/menu</a></li><li><a href="module-josm_unittest.html">josm/unittest</a></li><li><a href="module-josm_util.html">josm/util</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-josm_api-Api.html">josm/api~Api</a></li><li><a href="module-josm_api-ApiConfig.html">josm/api~ApiConfig</a></li><li><a href="module-josm_api-ChangesetApi.html">josm/api~ChangesetApi</a></li><li><a href="module-josm_builder-NodeBuilder.html">josm/builder~NodeBuilder</a></li><li><a href="module-josm_builder-RelationBuilder.html">josm/builder~RelationBuilder</a></li><li><a href="module-josm_builder-WayBuilder.html">josm/builder~WayBuilder</a></li><li><a href="module-josm_command.ChangeCommand.html">josm/command.ChangeCommand</a></li><li><a href="module-josm_command.CommandHistory.html">josm/command.CommandHistory</a></li><li><a href="module-josm_command.DeleteCommand.html">josm/command.DeleteCommand</a></li><li><a href="module-josm_command-AddCommand.html">josm/command~AddCommand</a></li><li><a href="module-josm_ds-DataSetUtil.html">josm/ds~DataSetUtil</a></li><li><a href="module-josm_ui_menu-MenuBar.html">josm/ui/menu~MenuBar</a></li><li><a href="NodeBuilder.NodeBuilder.html">NodeBuilder.NodeBuilder</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: josm/api.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">/**
 * This module provides functions to retrieve data from and upload data
 * to an OSM server.
 *
 * @example
 * const {Api, ChangesetApi, ApiConfig} = require('josm/api')
 *
 * @module josm/api
 */

/* global Java */
/* global require */

const URL = Java.type('java.net.URL')
const OsmApi = Java.type('org.openstreetmap.josm.io.OsmApi')
const Changeset = Java.type('org.openstreetmap.josm.data.osm.Changeset')
const OsmPrimitiveType = Java.type('org.openstreetmap.josm.data.osm.OsmPrimitiveType')
const PrimitiveId = Java.type('org.openstreetmap.josm.data.osm.PrimitiveId')
const SimplePrimitiveId = Java.type('org.openstreetmap.josm.data.osm.SimplePrimitiveId')
const NullProgressMonitor = Java.type('org.openstreetmap.josm.gui.progress.NullProgressMonitor')
const OsmServerChangesetReader = Java.type('org.openstreetmap.josm.io.OsmServerChangesetReader')
const OsmServerObjectReader = Java.type('org.openstreetmap.josm.io.OsmServerObjectReader')
const OsmServerBackreferenceReader = Java.type('org.openstreetmap.josm.io.OsmServerBackreferenceReader')
const Preferences = Java.type('org.openstreetmap.josm.data.Preferences')
const Bounds = Java.type('org.openstreetmap.josm.data.Bounds')
const LatLon = Java.type('org.openstreetmap.josm.data.coor.LatLon')

const util = require('josm/util')

/**
 * Creates a {@class org.openstreetmap.josm.data.coor.LatLon} from a
 * javascript object.
 *
 * @example
 * const { buildLatLon } = require('josm/api')
 * const pos = buildLatLon({lat: 1, lon: 2});
 *
 * @param {object} obj  a javascript object with two number properties
 *    &lt;code>lat:&lt;/code> and &lt;code>lon:&lt;/code>
 * @name buildLatLon
 * @static
 * @returns {org.openstreetmap.josm.data.coor.LatLon}
 * @summary Create a {@class org.openstreetmap.josm.data.coor.LatLon}
 *      from a javascript object.
 * @function
 */
exports.buildLatLon = function (obj) {
  util.assert(util.isSomething(obj), 'obj: must not be null or undefined');
  util.assert(typeof obj === 'object',
      'obj: expected an object, got {0}', obj);
  util.assert(util.isNumber(obj.lat),
      'obj.lat: expected a number, got {0}', obj.lat);
  util.assert(util.isNumber(obj.lon),
      'obj.lon: expected a number, got {0}', obj.lon);
  util.assert(LatLon.isValidLat(obj.lat),
      'obj.lat: expected a valid lat in the range [-90,90], got {0}',
      obj.lat);
  util.assert(LatLon.isValidLon(obj.lon),
      'obj.lon: expected a valid lon in the range [-180,180], got {0}',
      obj.lon);
  return new LatLon(obj.lat, obj.lon);
}

/**
 * Creates a {@ org.openstreetmap.josm.data.Bounds} instance from a javascript object.
 *
 * @example
 * let { buildBounds } = require('josm/api')
 * const bounds1 = buildBounds({minlat: 46.9479186, minlon: 7.4619484,
 *         maxlat: 46.9497642, maxlon: 7.4660683})
 *
 * const bounds2 = buildBounds({
 *    min: {lat: 46.9479186, lon: 7.4619484},
 *    max: {lat: 46.9497642, lon: 7.4660683}
 * })
 *
 * @param {object} obj  a javascript object
 * @return {org.openstreetmap.josm.data.Bounds} the bounds
 * @name buildBounds
 * @function
 * @static
 */
exports.buildBounds = function (obj) {
  util.assert(util.isSomething(obj), 'obj: must not be null or undefined')
  util.assert(typeof obj === 'object',
      'obj: expected an object, got {0}', obj)

  function normalizeLat(obj,name) {
      util.assert(util.isDef(obj[name]),
          '{0}: missing mandatory property', name)
      util.assert(util.isNumber(obj[name]),
          '{0}: expected a number, got {1}', name, obj[name])
      util.assert(LatLon.isValidLat(obj[name]),
          '{0}: expected a valid lat, got {1}', name, obj[name])
      return obj[name]
  }


  function normalizeLon(obj,name) {
      util.assert(util.isDef(obj[name]),
          '{0}: missing mandatory property', name)
      util.assert(util.isNumber(obj[name]),
          '{0}: expected a number, got {1}', name, obj[name])
      util.assert(LatLon.isValidLon(obj[name]),
          '{0}: expected a valid lon, got {1}', name, obj[name])
      return obj[name]
  }

  if (util.isDef(obj.minlat)) {
      const minlat = normalizeLat(obj.minlat)
      const minlon = normalizeLat(obj.minlon)
      const maxlat = normalizeLat(obj.maxlat)
      const maxlon = normalizeLat(obj.maxlon)
      return new Bounds(minlat, minlon, maxlat, maxlon)
  } else if (util.isDef(obj.min)) {
      const min = exports.buildLatLon(obj.min)
      const max = exports.buildLatLon(obj.max)
      return new Bounds(min,max)
  } else {
      util.assert(false,
          'obj: expected an object {min:.., max:..} or '
      + '{minlat:, maxlat:, minlon:, maxlon:}, got {0}', obj)
  }
}

/**
 * Provides methods to open, close, get, update, etc. changesets on the OSM
 * API server.
 *
 * &lt;strong>Note:&lt;/strong> this class doesn't provide a constructor. Methods
 * and properties are &lt;code>static&lt;/code>.
 *
 * @example
 * // load the changeset api
 * const { ChangesetApi } = require('josm/api')
 *
 * // create a new changeset on the server
 * const cs = ChangesetApi.open()
 *
 * @class
 * @summary Provides methods to open, close, get, and update changesets on the OSM API server
 * @name ChangesetApi
 */
exports.ChangesetApi = {}

/**
 * Creates and opens a changeset
 *
 * &lt;ul>
 *   &lt;li>&lt;code>open()&lt;/code>  - open a new changeset with no tags&lt;/li>
 *   &lt;li>&lt;code>open(aChangeset)&lt;/code>  - open a new changeset with the tags
 *   from &lt;code>aChangeset&lt;/code>&lt;/li>
 *   &lt;li>&lt;code>open(anObject)&lt;/code>  - open a new changeset with the tags
 *   given by the properties of &lt;code>anObject&lt;/code>&lt;/li>
 * &lt;/ul>
 *
 * @example
 * const { ChangesetApi } = require('josm/api')
 * const Changeset = Java.type('org.openstreetmap.josm.data.osm.Changeset')
 *
 * // open a new changeset with no tags
 * const cs1 = ChangesetApi.open()
 *
 * // open a new changeset with the tags given by the supplied changeset
 * const cs2 = new Changeset()
 * cs2.put('comment', 'a test comment')
 * cs2 = ChangesetApi.open(cs2)
 *
 * // open a new changeset with the tags given by the object
 * var cs3 = ChangesetApi.open({comment: 'a test comment'})
 *
 * @static
 * @returns {org.openstreetmap.josm.data.osm.Changeset} the changeset
 * @summary Creates and opens a changeset
 * @function
 * @memberof module:josm/api~ChangesetApi
 * @name open
 * @param {org.openstreetmap.josm.data.osm.Changeset | object} [changeset] the changeset to open
 */
exports.ChangesetApi.open = function () {
  let cs
  switch (arguments.length) {
    case 0:
      cs = new Changeset()
      break

    case 1:
      var o = arguments[0]
      if (o instanceof Changeset) {
        cs = o
      } else if (typeof o === 'object') {
        cs = new Changeset()
        for (var p in o) {
          if (!util.hasProp(o, p)) continue
          var key = p
          var value = o[p]
          key = util.trim(key)
          value = value + '' // convert to string
          cs.put(key, value)
        }
      } else {
        util.assert(false,
          'Unexpected type of argument, expected Changeset or object, ' +
          'got {0}', o)
      }
      break

    default:
      util.assert(false, 'Unexpected number of arguments, got {0}',
        arguments.length)
  }
  var api = OsmApi.getOsmApi()
  api.openChangeset(cs, NullProgressMonitor.INSTANCE)
  return cs
}

/**
 * Closes a changeset
 *
 * &lt;dl>
 *   &lt;dt>&lt;code class='signature'>close(id)&lt;/code>&lt;/dt>
 *   &lt;dd class="param-desc">closes the changeset with the given id&lt;/dd>
 *
 *   &lt;dt>&lt;code class='signature'>close(aChangeset)&lt;/code>&lt;dt>
 *   &lt;dd class="param-desc">Xloses the changeset given by &lt;code>aChangeset&lt;/code>&lt;/dd>
 * &lt;/dl>
 *
 * @example
 * const { ChangesetApi } = require('josm/api')
 * const util = require('josm/util')
 * const Changeset = Java.type('org.openstreetmap.josm.data.osm.Changeset')
 *
 * // closs the changeset 12345
 * ChangesetApi.close(12345)
 *
 * // open a new changeset with the tags given by the supplied changeset
 * const cs2 = new Changeset(12345)
 * cs2 = ChangesetApi.close(cs2)
 * util.assert(cs2.closed)  // the changeset is now closed
 *
 * @param {number | org.openstreetmap.josm.data.osm.Changeset} changeset the changeset to close
 * @returns {org.openstreetmap.josm.data.osm.Changeset} the changeset
 * @summary Closes a changeset
 * @memberof module:josm/api~ChangesetApi
 * @function
 * @name close
 */
exports.ChangesetApi.close = function () {
  let cs
  switch (arguments.length) {
    case 0:
      util.assert(false,
        'Missing arguments. Expected a changeset it or a changeset')
      break

    case 1: {
      const o = arguments[0]
      if (o instanceof Changeset) {
        cs = o
      } else if (util.isNumber(o)) {
        util.assert(o > 0, 'Expected a positive changeset id, got {0}', o)
        cs = new Changeset(o)
      } else {
        util.assert(false,
          'Unexpected type of argument, expected Changeset or number, ' +
          'got {0}', o)
      }
      break
    }

    default:
      util.assert(false, 'Unexpected number of arguments, got {0}',
        arguments.length)
  }
  const api = OsmApi.getOsmApi()
  api.closeChangeset(cs, NullProgressMonitor.INSTANCE)
  return cs
}

/**
 * Updates a changeset
 *
 * &lt;dl>
 *   &lt;dt>&lt;code class='signature'>update(aChangeset)&lt;/code>&lt;/dt>
 *   &lt;dd class="param-desc">Updates the changeset &lt;code>aChangeset&lt;/code>&lt;/dd>
 * &lt;/dl>
 *
 * @example
 * const { ChangesetApi } = require('josm/api')
 * const Changeset = Java.type('org.openstreetmap.josm.data.osm.Changeset')
 *
 * // update the comment of a changeset
 * const cs2 = new Changeset(12345)
 * cs2.put('comment', 'an updated comment')
 * cs2 = ChangesetApi.update(cs2)
 *
 * @param {org.openstreetmap.josm.data.osm.Changeset} changeset  the changeset to update
 * @static
 * @returns {org.openstreetmap.josm.data.osm.Changeset} the changeset
 * @summary Updates a changeset
 * @function
 * @memberof module:josm/api~ChangesetApi
 * @name update
 */
exports.ChangesetApi.update = function () {
  let cs
  switch (arguments.length) {
    case 0:
      util.assert(false, 'Missing arguments. Expected a changeset')
      break

    case 1: {
      const o = arguments[0]
      if (o instanceof Changeset) {
        cs = o
      } else {
        util.assert(false,
          'Unexpected type of argument, expected Changeset, got {0}', o)
      }
      break
    }

    default:
      util.assert(false, 'Unexpected number of arguments, got {0}',
        arguments.length)
  }
  const api = OsmApi.getOsmApi()
  api.updateChangeset(cs, NullProgressMonitor.INSTANCE)
  return cs
}

/**
 * Get a changeset from the server
 *
 * &lt;dl>
 *   &lt;dt>&lt;code class='signature>get(aChangeset)&lt;/code>&lt;/dt>
 *   &lt;dd class="param-desc">Gets the changeset specified by &lt;code>aChangeset&lt;/code>. aChangset
 *   must be an instance of &lt;code>Changeset&lt;/code>.
 *   aChangeset.id &amp;gt 0 expected.&lt;/dd>
 *
 *   &lt;dt>&lt;code class='signature'>get(id)&lt;/code>&lt;/dt>
 *   &lt;dd class="param-desc">gets the changeset for the id. id must be a number &amp;gt 0.&lt;/dd>
 * &lt;/dl>
 *
 * @example
 * const { ChangesetApi } = require('josm/api')
 * const Changeset = Java.type('org.openstreetmap.josm.data.osm.Changeset')
 *
 * // get the changeset with id 12345
 * const cs1 = ChangesetApi.get(12345)
 *
 * // get the changeset with id 12345
 * const cs2 = new Changeset(12345)
 * cs2 = ChangesetApi.get(cs2)
 *
 * @param {number|org.openstreetmap.josm.data.osm.Changeset} changeset the changeset to close
 * @static
 * @returns {org.openstreetmap.josm.data.osm.Changeset} the changeset
 * @summary Get a changeset from the server
 * @memberof module:josm/api~ChangesetApi
 * @name get
 * @function
 * @param {number | org.openstreetmap.josm.data.osm.Changeset} changeset
 */
exports.ChangesetApi.get = function () {
  let cs
  switch (arguments.length) {
    case 0:
      util.assert(false,
        'Missing arguments. Expected a changeset id or a changeset')
      break

    case 1: {
      const o = arguments[0]
      if (o instanceof Changeset) {
        cs = o
      } else if (util.isNumber(o)) {
        util.assert(o > 0, 'Expected a positive changeset id, got {0}', o)
        cs = new Changeset(o)
      } else {
        util.assert(false,
          'Unexpected type of argument, expected Changeset or number, ' +
          'got {0}', o)
      }
      break
    }

    default:
      util.assert(false, 'Unexpected number of arguments, got {0}',
        arguments.length)
  }
  const reader = new OsmServerChangesetReader()
  cs = reader.readChangeset(cs.id, NullProgressMonitor.INSTANCE)
  return cs
}

/**
 * Collection of static methods to download objects from and upload objects
 * to the OSM server.
 *
 * &lt;strong>Note:&lt;/strong> this class doesn't provide a constructor.
 * Methods and properties are 'static'.
 *
 * @example
 * // load the api
 * const { Api } = require('josm/api')
 *
 * // download node 12345
 * const ds = Api.downloadObject(12345, 'node')
 *
 * @class
 * @summary Collection of static methods to download objects from and upload objects
 *  to the OSM server
 * @name Api
 */
exports.Api = function () {}

function normalizeType (type) {
  util.assert(util.isSomething(type), 'type must not be null or undefined')
  if (util.isString(type)) {
    try {
      type = OsmPrimitiveType.fromApiTypeName(type)
    } catch (e) {
      util.assert(false, 'Invalid primitive type, got \'\'{0}\'\'', type)
    }
  } else if (type instanceof OsmPrimitiveType) {
    if (![OsmPrimitiveType.NODE, OsmPrimitiveType.WAY, OsmPrimitiveType.RELATION].contains(type)) {
      util.assert(false, 'Invalid primitive type, got {0}', type)
    }
  } else {
    util.assert(false, 'Invalid primitive type, got {0}', type)
  }
  return type
}

function normalizeId (id) {
  util.assert(util.isSomething(id), 'id must not be null or nothing')
  util.assert(util.isNumber(id), 'Expected a number as id, got {0}', id)
  util.assert(id > 0, 'Expected a positive number as id, got {0}', id)
  return id
}

function primitiveIdFromObject (o) {
  util.assert(util.hasProp(o, 'id'),
    'Mandatory property \'\'id\'\' is missing in object {0}', o)
  util.assert(util.hasProp(o, 'type'),
    'Mandatory property \'\'type\'\' is missing in object {0}', o)
  return new SimplePrimitiveId(normalizeId(o.id), normalizeType(o.type))
}

function downloadObject1 () {
  let id
  const o = arguments[0]
  util.assert(util.isSomething(o),
    'Argument 0: must not be null or undefined')
  if (o instanceof PrimitiveId) {
    id = o
  } else if (typeof o === 'object') {
    id = primitiveIdFromObject(o)
  } else {
    util.assert(false, 'Argument 0: unexpected type, got {0}', o)
  }
  var reader = new OsmServerObjectReader(id, false)
  var ds = reader.parseOsm(null /* null progress monitor */)
  return ds
}

function optionFull (options) {
  if (!util.hasProp(options, 'full')) return undefined
  var o = options.full
  if (typeof o === 'boolean') return o
  util.assert('Expected a boolean value for option \'\'full\'\', got {0}', o)
}

function optionVersion (options) {
  if (!util.hasProp(options, 'version')) return undefined
  var o = options.version
  util.assert(util.isNumber(o),
    'Expected a number for option \'\'version\'\', got {0}', o)
  util.assert(o > 0,
    'Expected a number > 0 for option \'\'version\'\', got {0}', o)
  return o
}

function downloadObject2 () {
  function parseOptions (arg) {
    const options = { full: undefined, version: undefined }
    if (!(typeof arg === 'object')) {
      return options
    }
    options.full = optionFull(arg)
    options.version = optionVersion(arg)
    return options
  }

  let id
  let options = { full: undefined, version: undefined }

  if (util.isNumber(arguments[0])) {
    id = normalizeId(arguments[0])
    var type = normalizeType(arguments[1])
    id = new SimplePrimitiveId(id, type)
  } else if (arguments[0] instanceof PrimitiveId) {
    id = arguments[0]
    options = parseOptions(arguments[1])
  } else if (typeof arguments[0] === 'object') {
    id = primitiveIdFromObject(arguments[0])
    options = parseOptions(arguments[1])
  } else {
    util.assert(false, 'Unsupported types of arguments')
  }
  var reader
  if (util.isDef(options.version)) {
    reader = new OsmServerObjectReader(id, options.version)
  } else {
    reader = new OsmServerObjectReader(id, !!options.full)
  }
  var ds = reader.parseOsm(null /* null progress monitor */)
  return ds
}

function downloadObject3 () {
  const options = { full: undefined, version: undefined }
  var n = normalizeId(arguments[0])
  var type = normalizeType(arguments[1])
  var id = new SimplePrimitiveId(n, type)

  util.assert(typeof arguments[2] === 'object',
    'Expected an object with named parameters, got {0}', arguments[2])
  options.full = optionFull(arguments[2])
  options.version = optionVersion(arguments[2])
  let reader
  if (util.isDef(options.version)) {
    reader = new OsmServerObjectReader(id, options.version)
  } else {
    reader = new OsmServerObjectReader(id, !!options.full)
  }
  var ds = reader.parseOsm(null /* null progress monitor */)
  return ds
}

/**
 * Downloads an object from the server.
 *
 * There are multiple options to specify what object to download.
 * In addition, the function accepts a set of optional named parameters
 * as last argument.
 *
 * &lt;dl>
 *   &lt;dt>&lt;code class='signature'>downloadObject(id, type, ?options)&lt;/code>&lt;/dt>
 *   &lt;dd class="param-desc">&lt;code>id&lt;/code> is the global numeric id.
 *   &lt;code>type&lt;/code> is either one of the strings 'node', 'way',
 *   or 'relation', or one of the  enumeration OsmPrimitiveType.NODE,
 *   OsmPrimitiveType.WAY, or OsmPrimitiveType.RELATION
 *   &lt;/dd>
 *
 *   &lt;dt>&lt;code class='signature'>downloadObject(id, ?options)&lt;/code>&lt;/dt>
 *   &lt;dd class="param-desc">&lt;code>id&lt;/code> is a &lt;code>PrimitiveId&lt;/code> or an object
 *   with the (mandatory) properties &lt;code>id&lt;/code> and &lt;code>type&lt;/code>,
 *   i.e. an object &lt;code>{id: ..., type: ...}&lt;/code>.
 *   &lt;code>id&lt;/code> is again a number, &lt;code>type&lt;/code> is again either one
 *   of the strings 'node', 'way', or 'relation', or one of the
 *   enumeration OsmPrimitiveType.NODE, OsmPrimitiveType.WAY,
 *   or OsmPrimitiveType.RELATION.
 *   &lt;/dd>
 * &lt;/dl>
 *
 * In both cases, &lt;code>?options&lt;/code> is an (optional) object with the
 * following two (optional) properties:
 * &lt;dl>
 *   &lt;dt>&lt;code class='signature'>full&lt;/code>: boolean&lt;/dt>
 *   &lt;dd class="param-desc">If &lt;code>true&lt;/code>, the object and its immediate children are
 *   downloaded, i.e. the nodes of a way and
 *   the relation members of a relation. Default if missing is
 *   &lt;code>false&lt;/code>.&lt;/dd>
 *
 *   &lt;dt>&lt;code class='signature'>version&lt;/code>: number&lt;/dt>
 *   &lt;dd class="param-desc">If present, the specified version of the object is downloaded.
 *   If missing, the current version is downloaded. If present, the
 *   option &lt;code>full&lt;/code> is ignored.&lt;/dd>
 * &lt;/dl>
 *
 * @example
 * const { Api } = require('josm/api')
 * const SimplePrimitiveId = Java.type('org.openstreetmap.josm.data.osm.SimplePrimitiveId')
 * const OsmPrimitiveType = Java.type('org.openstreetmap.josm.data.osm.OsmPrimitiveType')
 *
 * // download the node with id 12345
 * const ds1 = Api.downloadObject(12345, 'node')
 *
 * // download the node with id 12345
 * const ds2 = Api.downloadObject({id: 12345, type: 'node'})
 *
 * // download the full relation (including its members) with id 12345
 * const id = new SimplePrimitiveId(12345, OsmPrimitiveType.RELATION)
 * const ds3 = Api.downloadObject(id, {full: true})
 *
 * // download version 5 of the full way 12345 (including its nodes)
 * const ds4 = Api.downloadObject(12345, OsmPrimitiveType.WAY, {version: 5})
 *
 * @static
 * @returns {org.openstreetmap.josm.data.osm.DataSet} the downloaded primitives
 * @summary Downloads an object from the server.
 * @memberof module:josm/api~Api
 * @function
 * @name downloadObjects
 * @param args see description and examples
 */
exports.Api.downloadObject = function () {
  switch (arguments.length) {
    case 0:
      util.assert(false, 'Unexpected number of arguments, got {0}',
        arguments.length)
      break
    case 1:
      return downloadObject1.apply(this, arguments)

    case 2:
      return downloadObject2.apply(this, arguments)

    case 3:
      return downloadObject3.apply(this, arguments)

    default:
      util.assert(false, 'Unexpected number of arguments, got {0}',
        arguments.length)
  }
}

function downloadReferrer1 () {
  let id
  const o = arguments[0]
  util.assert(util.isSomething(o),
    'Argument 0: must not be null or undefined')
  if (o instanceof PrimitiveId) {
    id = o
  } else if (typeof o === 'object') {
    id = primitiveIdFromObject(o)
  } else {
    util.assert(false, 'Argument 0: unexpected type, got {0}', o)
  }
  const reader = new OsmServerBackreferenceReader(id.getUniqueId(),
    id.getType())
  const ds = reader.parseOsm(NullProgressMonitor.INSTANCE)
  return ds
}

function downloadReferrer2 () {
  let id
  let type
  const options = { full: undefined }
  if (util.isNumber(arguments[0])) {
    id = normalizeId(arguments[0])
    type = normalizeType(arguments[1])
    id = new SimplePrimitiveId(id, type)
  } else if (arguments[0] instanceof PrimitiveId) {
    id = arguments[0]
    const o = arguments[1]
    if (util.isSomething(o)) {
      util.assert(typeof o === 'object',
        'Expected an object with named parameters, got {0}', o)
      options.full = optionFull(o)
    }
  } else if (typeof arguments[0] === 'object') {
    id = primitiveIdFromObject(arguments[0])
    const o = arguments[1]
    if (util.isSomething(o)) {
      util.assert(typeof o === 'object',
        'Expected an object with named parameters, got {0}', o)
      options.full = optionFull(o)
    }
  } else {
    util.assert(false, 'Unsupported types of arguments')
  }
  const reader = new OsmServerBackreferenceReader(id.getUniqueId(),
    id.getType())
  if (options.full) {
    reader.setReadFull(true)
  }
  const ds = reader.parseOsm(NullProgressMonitor.INSTANCE)
  return ds
}

function downloadReferrer3 () {
  const options = { full: undefined }
  const n = normalizeId(arguments[0])
  const type = normalizeType(arguments[1])
  const id = new SimplePrimitiveId(n, type)

  util.assert(typeof arguments[2] === 'object',
    'Expected an object with named parameters, got {0}', arguments[2])
  options.full = optionFull(arguments[2])

  const reader = new OsmServerBackreferenceReader(id.getUniqueId(),
    id.getType())
  if (options.full) {
    reader.setReadFull(true)
  }
  const ds = reader.parseOsm(NullProgressMonitor.INSTANCE)
  return ds
}

/**
 * Downloads the objects &lt;em>referring&lt;/em> to another object from
 * the server.
 *
 * Downloads primitives from the OSM server which
 * refer to a specific primitive. Given a node, the referring ways and
 * relations are downloaded. Given a way or a relation, only referring
 * relations are downloaded.
 *
 * The default behaviour is to reply proxy objects only.
 *
 * If you set the option &lt;code>{full: true}&lt;/code>, every referring object
 * is downloaded in full.
 *
 * There are multiple options to specify what referrers to download.
 * In addition, the function accepts a set of optional named parameters as
 * last argument.
 *
 * &lt;dl>
 *   &lt;dt>&lt;code class='signature'>downloadReferrer(id, type, ?options)
 *       &lt;/code>&lt;/dt>
 *   &lt;dd class="param-desc">&lt;code>id&lt;/code> is the global numeric id.
 *   &lt;code>type&lt;/code> is either one of the strings 'node', 'way', or
 *   'relation', or one of the  enumeration
 *   {@class org.openstreetmap.josm.data.osm.OsmPrimitiveType}.NODE,
 *   {@class org.openstreetmap.josm.data.osm.OsmPrimitiveType}.WAY,
 *   or {@class org.openstreetmap.josm.data.osm.OsmPrimitiveType}.RELATION.
 *   &lt;/dd>
 *
 *   &lt;dt>&lt;code class='signature'>downloadReferrer(id, ?options)&lt;/code>&lt;/dt>
 *   &lt;dd class="param-desc">&lt;code>id&lt;/code> is a &lt;code>PrimitiveId&lt;/code> or an object
 *   with the (mandatory) properties &lt;code>id&lt;/code> and &lt;code>type&lt;/code>,
 *   i.e. an object &lt;code>{id: ..., type: ...}&lt;/code>.
 *   &lt;code>id&lt;/code> is again a number, &lt;code>type&lt;/code> is again either one
 *   of the strings 'node', 'way', or 'relation', or one of the
 *   enumeration
 *   {@class org.openstreetmap.josm.data.osm.OsmPrimitiveType}.NODE,
 *   {@class org.openstreetmap.josm.data.osm.OsmPrimitiveType}.WAY,
 *   or {@class org.openstreetmap.josm.data.osm.OsmPrimitiveType}.RELATION.
 *   &lt;/dd>
 * &lt;/dl>
 *
 * In both cases, &lt;code>?options&lt;/code> is an (optional) object with the
 * following  (optional) property:
 * &lt;dl>
 *   &lt;dt>&lt;code class='signature'>full&lt;/code>:boolean&lt;/dt>
 *   &lt;dd class="param-desc">If &lt;code>true&lt;/code>, the the &lt;strong>full&lt;/strong> objects are
 *   retrieved using multi-gets. If missing or &lt;code>false&lt;/code>,
 *   only proxy objects are downloaded. Default: false&lt;/dd>
 * &lt;/dl>
 *
 * @example
 * const { Api } = require('josm/api')
 * const { NodeBuilder } = require('josm/builder')
 * const SimplePrimitiveId = Java.type('org.openstreetmap.josm.data.osm.SimplePrimitiveId')
 * const OsmPrimitiveType = Java.type('org.openstreetmap.josm.data.osm.OsmPrimitiveType')
 *
 * // download the objects referring to the node with id 12345
 * const ds1 = Api.downloadReferrer(12345, 'node')
 *
 * // download the objects referring to the node with id 12345
 * const ds2 = Api.downloadReferrer({id: 12345, type: 'node'})
 *
 * // download the relations referring to the  relation with id 12345.
 * // Referring relations are downloaded in full.
 * const id = new SimplePrimitiveId(12345, OsmPrimitiveType.RELATION)
 * const ds3 = Api.downloadReferrer(id, { full: true })
 *
 * // create the global node 12345 ...
 * const node = NodeBuilder.create(12345)
 * // ... and downloads its referrers in full
 * const ds = Api.downloadReferrer(node, { full: true })
 *
 * @static
 * @returns {org.openstreetmap.josm.data.osm.DataSet} the downloaded primitives
 * @summary Downloads the objects &lt;em>referring&lt;/em> to another object from
 *     the server.
 * @memberof module:josm/api~Api
 * @function
 * @name downloadReferrer
 * @param args see description and examples
 */
exports.Api.downloadReferrer = function () {
  switch (arguments.length) {
    case 0:
      util.assert(false, 'Unexpected number of arguments, got {0}',
        arguments.length)
      break

    case 1:
      return downloadReferrer1.apply(this, arguments)

    case 2:
      return downloadReferrer2.apply(this, arguments)

    case 3:
      return downloadReferrer3.apply(this, arguments)

    default:
      util.assert(false, 'Unexpected number of arguments, got {0}',
        arguments.length)
  }
}

/**
 * Downloads the objects within a bounding box.
 *
 * @example
 * const { Api } = require('josm/api')
 * const ds1 = Api.downloadArea(new Bounds(
 *     new LatLon(46.9479186,7.4619484),   // min
 *     new LatLon(46.9497642, 7.4660683)   // max
 * ))
 *
 * const ds2 = Api.downloadArea({
 *     min: {lat: 46.9479186, lon: 7.4619484},
 *     max: {lat: 46.9497642, lon: 7.4660683}
 * })
 *
 * @static
 * @returns {org.openstreetmap.josm.data.osm.DataSet} the downloaded primitives
 * @summary Downloads the objects within a bounding box
 * @param {org.openstreetmap.josm.data.Bounds|object} bounds the bounding box
 * @memberof module:josm/api~Api
 * @name downloadArea
 * @function
  */
exports.Api.downloadArea = function () {
  const BoundingBoxDownloader =
    Java.type('org.openstreetmap.josm.io.BoundingBoxDownloader')
  const NullProgressMonitor =
    Java.type('org.openstreetmap.josm.gui.progress.NullProgressMonitor')
  const Bounds = Java.type('org.openstreetmap.josm.data.Bounds')

  util.assert(arguments.length === 1, 'Expected 1 argument, got {0}',
    arguments.length)
  let bounds = arguments[0]
  util.assert(util.isSomething(bounds),
    'bounds: must not be null or undefined')
  if (bounds instanceof Bounds) {
    // do nothing
  } else if (typeof bounds === 'object') {
    bounds = exports.buildBounds(bounds) // convert to bounds
  } else {
    util.assert(false,
      'expected an instance of Bounds or an object, got {0}', bounds)
  }
  const downloader = new BoundingBoxDownloader(bounds)
  return downloader.parseOsm(NullProgressMonitor.INSTANCE)
}

/**
 * Uploads objects to the server.
 *
 * You can submit data either as
 * {@class org.openstreetmap.josm.data.osm.DataSet},
 * {@class org.openstreetmap.josm.data.APIDataSet}, javascript array of
 * {@class org.openstreetmap.josm.data.osm.OsmPrimitive}s or
 * a {@class java.util.Collection} of
 * {@class org.openstreetmap.josm.data.osm.OsmPrimitive}s.
 *
 * This method supports the same upload strategy as the JOSM upload dialog.
 * Supply the named parameter &lt;code>{strategy: ...}&lt;/code> to choose the
 * strategy.
 *
 * &lt;p class='documentation-warning'>
 * Be careful when uploading data to the OSM server! Do not upload copyright-
 * protected or test data.
 * &lt;/p>
 *
 *
 * The method takes care to update the primitives in the uploaded data when
 * the upload succeeds. For instance, uploaded new primitives become global
 * objects and get assigned their new id and version, successfully deleted
 * objects become invisible, etc.
 *
 * Even if the entire upload of a dataset fails, a subset therefore may
 * have been uploaded successfully. In order to keep track, which pritives
 * have been uploaded successfully in case of an error, the method replies a
 * collection of the successfully uploaded objects.
 * &lt;p>
 * &lt;strong>Named options&lt;/strong>
 * &lt;/p>
 * &lt;dl>
 *   &lt;dt>&lt;code class='signature'>strategy: string|
 *   {@class org.openstreetmap.josm.io.UploadStrategy}&lt;/code>&lt;/dt>
 *   &lt;dd class="param-desc">Indicates how the data is uploaded. Either one of the strings
 *     &lt;ul>
 *          &lt;li>individualobjects&lt;/li>
 *          &lt;li>chunked&lt;/li>
 *          &lt;li>singlerequest&lt;/li>
 *       &lt;/ul>
 *      or one of the enumeration values in
 *      {@class org.openstreetmap.josm.io.UploadStrategy}.
 *      Default falue: UploadStrategy.DEFAULT_UPLOAD_STRATEGY
 *   &lt;/dd>
 *
 *    &lt;dt>&lt;code class='signature'>changeset:
 *        number|{@class org.openstreetmap.josm.data.osm.Changeset}&lt;/code>&lt;/dt>
 *    &lt;dd class="param-desc">The changeset to which the data is uploaded. Either a number
 *       (the changeset id) or a
 *       {@class org.openstreetmap.josm.data.osm.Changeset} instance.
 *       Default: creates a new changeset.&lt;/dd>
 *
 *    &lt;dt>&lt;code class='signature'>chunkSize: number&lt;/code>&lt;/dt>
 *    &lt;dd class="param-desc">The size of an upload chunk, if the data is uploaded with the
 *    upload strategy
 *    {@class org.openstreetmap.josm.io.UploadStrategy}.CHUNKED_DATASET_STRATEGY.&lt;/dd>
 *
 *    &lt;dt>&lt;code class='signature'>closeChangeset: boolean&lt;/code>&lt;/dt>
 *    &lt;dd class="param-desc">If true, closes the changeset after the upload. Default: true&lt;/dd>
 * &lt;/dl>
 *
 * @example
 * const DataSet = Java.type('org.openstreetmap.josm.data.osm.DataSet')
 * const { WayBuilder } = require('josm/builder')
 * const { Api }= require('josm/api')
 * const ds = new DataSet()
 * WayBuilder
 *  .forDataSet(ds)
 *  .withNodes(
 *     ds.nodeBuilder.withTags({name: 'node1'}).create(),
 *     ds.nodeBuilder.withTags({name: 'node2'}.create()
 *  )
 *  .withTags({name: 'way1'})
 *  .create()
 *
 * // uploads the data in a new changeset in one chunk
 * const processed = Api.upload(ds, 'just testing')
 *
 * @param {org.openstreetmap.josm.data.osm.DataSet|
 *         org.openstreetmap.josm.data.APIDataSet|array|java.util.Collection} data the data to upload
 * @param {string} comment the upload comment
 * @param {object} [options] various options (see above)
 * @static
 * @returns {java.util.Collection}
 * @summary Uploads objects
 * @memberof module:josm/api~Api
 * @name upload
 * @function
 */
exports.Api.upload = function (data, comment, options) {
  const UploadStrategy = Java.type('org.openstreetmap.josm.io.UploadStrategy')
  const Changeset = Java.type('org.openstreetmap.josm.data.osm.Changeset')
  const APIDataSet = Java.type('org.openstreetmap.josm.data.APIDataSet')
  const DataSet = Java.type('org.openstreetmap.josm.data.osm.DataSet')
  const UploadStrategySpecification =
    Java.type('org.openstreetmap.josm.io.UploadStrategySpecification')
  const Collection = Java.type('java.util.Collection')
  const OsmServerWriter = Java.type('org.openstreetmap.josm.io.OsmServerWriter')

  comment = comment || ''
  comment = String(comment)

  util.assertSomething(data, 'data: must not be null or undefined')
  options = options || {}
  util.assert(typeof options === 'object',
    'options: expected an object with named arguments, got {0}', options)

  function normalizeChunkSize (size) {
    util.assert(util.isNumber(size),
      'chunksize: expected a number, got {0}', size)
    util.assert(size >= -1,
      'chunksize: expected -1 or a number > 0, got {0]', size)
    return size
  }

  function normalizeChangeset (changeset) {
    if (util.isNothing(changeset)) {
      return new Changeset()
    } else if (util.isNumber(changeset)) {
      util.assert(changeset > 0,
        'changeset: expected a changeset id > 0, got {0}', changeset)
      return new Changeset(changeset)
    } else if (changeset instanceof Changeset) {
      return changeset
    } else {
      util.assert(false, 'changeset: unexpected value, got {0}',
        changeset)
    }
  }

  function uploadSpecFromOptions (options) {
    let strategy = options.strategy ||
      UploadStrategy.DEFAULT_UPLOAD_STRATEGY
    strategy = UploadStrategy.from(strategy)

    let chunkSize = options.chunkSize ||
      UploadStrategySpecification.UNSPECIFIED_CHUNK_SIZE
    chunkSize = normalizeChunkSize(chunkSize)

    let closeChangeset = util.isDef(options.closeChangeset)
      ? options.closeChangeset : true
    closeChangeset = Boolean(closeChangeset)

    const spec = new UploadStrategySpecification()
    spec.setStrategy(strategy)
    spec.setChunkSize(chunkSize)
    spec.setCloseChangesetAfterUpload(closeChangeset)
    return spec
  }

  let apiDataSet
  if (data instanceof DataSet) {
    apiDataSet = new APIDataSet(data)
  } else if (data instanceof APIDataSet) {
    apiDataSet = data
  } else if (util.isArray(data)) {
    apiDataSet = new APIDataSet(data)
  } else if (data instanceof Collection) {
    apiDataSet = new APIDataSet(data)
  } else {
    util.assert(false, 'data: unexpected type of value, got {0}', data)
  }

  if (apiDataSet.isEmpty()) return undefined
  apiDataSet.adjustRelationUploadOrder()
  const toUpload = apiDataSet.getPrimitives()

  let changeset = options.changeset || new Changeset()
  changeset = normalizeChangeset(changeset)
  changeset.put('comment', comment)
  const spec = uploadSpecFromOptions(options)
  const writer = new OsmServerWriter()

  writer.uploadOsm(spec, toUpload, changeset, null /* progress monitor */)
  if (spec.isCloseChangesetAfterUpload()) {
    exports.ChangesetApi.close(changeset)
  }

  return writer.getProcessedPrimitives()
}

/* -------------------------------------------------------------------------- */
/* ApiConfig                                                                  */
/* -------------------------------------------------------------------------- */
/**
 * ApiConfig provides methods and properties for configuring API parameters.
 *
 *
 * @class
 * @summary ApiConfig provides methods and properties for configuring API parameters
 * @name ApiConfig
 */
exports.ApiConfig = function() {}

const DEFAULT_URL = 'http://api.openstreetmap.com/api/0.6'

/**
 * Get or set the API server URL.
 *
 * &lt;dl>
 *   &lt;dt>&lt;code class='signature'>get&lt;/code>&lt;/dt>
 *   &lt;dd class="param-desc">Replies the currently configured server URL or undefinend, if no
 *   server URL is configured.&lt;/dd>
 *
 *   &lt;dt>&lt;code class='signature'>set&lt;/code>&lt;/dt>
 *   &lt;dd class="param-desc">Sets the current server URL. If null or undefined, removes the
 *   current configuration. Accepts either a string or a {@class java.net.URL}.
 *   Only accepts http or https URLs.
 *   &lt;/dd>
 * &lt;/dl>
 *
 * @example
 * const { ApiConfig } = require('josm/api')
 * ApiConfig.serverUrl   // -> the current server url
 *
 * // set a new API url
 * ApiConfig.serverUrl = 'http://api06.dev.openstreetmap.org'
 *
 * @static
 * @summary Get or set the API server URL.
 * @property {string} serverUrl
 * @name serverUrl
 * @memberof module:josm/api~ApiConfig
 */
Object.defineProperty(exports.ApiConfig, 'serverUrl', {
  enumerable: true,
  get: function () {
    var url = Preferences.main().get('osm-server.url', null)
    if (url == null) url = DEFAULT_URL
    return url == null ? undefined : util.trim(url)
  },

  set: function (value) {
    if (util.isNothing(value)) {
      Preferences.main().put('osm-server.url', null)
    } else if (value instanceof URL) {
      util.assert(value.getProtocol() === 'http' || value.getProtocol() === 'https',
        'url: expected a http or https URL, got {0}', value)
      Preferences.main().put('osm-server.url', value.toString())
    } else if (util.isString(value)) {
      value = util.trim(value)
      try {
        const url = new URL(value)
        util.assert(url.getProtocol() === 'http' || url.getProtocol() === 'https',
          'url: expected a http or https URL, got {0}',
          url.toString())
        Preferences.main().put('osm-server.url', url.toString())
      } catch (e) {
        util.assert(false,
          'url: doesn\'\'t look like a valid URL, got {0}. Error: {1}',
          value, e)
      }
    } else {
      util.assert(false, 'Unexpected type of value, got {0}', value)
    }
  }
})

/**
 * Get the default server URL.
 *
 * @example
 * const { ApiConfig } = require('josm/api')
 * ApiConfig.defaultServerUrl   // -> the default server url
 *
 * @static
 * @summary Get the default server URL
 * @name defaultServerUrl
 * @property {string} defaultServerUrl the default server URL
 * @readOnly
 * @memberof module:josm/api~ApiConfig
 */
Object.defineProperty(exports.ApiConfig, 'defaultServerUrl', {
  value: DEFAULT_URL,
  writable: false,
  enumerable: true
})

function normalizeAuthMethod (authMethod) {
  util.assert(util.isString(authMethod),
    'authMethod: expected a string, got {0}',
    authMethod)
  authMethod = util.trim(authMethod).toLowerCase()
  util.assert(authMethod === 'basic' || authMethod === 'oauth',
    'Unsupported value for authMethod, got {0}', authMethod)
  return authMethod
}

/**
 * Get or set the authentication method.
 *
 * JOSM uses two authentication methods:
 * &lt;dl>
 *    &lt;dt>&lt;code class='signature'>basic&lt;/code>&lt;/dt>
 *    &lt;dd class="param-desc">Basic authentication with a username and a password&lt;/dd>
 *    &lt;dt>&lt;code class='signature'>oauth&lt;/code>&lt;/dt>
 *    &lt;dd class="param-desc">Authentication with the &lt;a href='http://oauth.net/'>OAuth&lt;/a>
 *        protocol.&lt;/dd>
 * &lt;/dl>
 *
 * @example
 * const { ApiConfig } = require('josm/api')
 * ApiConfig.authMethod   // -> the current authentication method
 *
 * // set OAuth as authentication method
 * ApiConfig.authMethod = 'oauth'
 *
 * @static
 * @summary Get or set the authentication method.
 * @type string
 * @name authMethod
 * @property {string} authMethod the authentication method
 * @memberof module:josm/api~ApiConfig
 */
Object.defineProperty(exports.ApiConfig, 'authMethod', {
  enumerate: true,
  get: function () {
    var authMethod = Preferences.main().get('osm-server.auth-method', 'basic')
    authMethod = util.trim(authMethod).toLowerCase()
    if (authMethod === 'basic' || authMethod === 'oauth') return authMethod
    // unsupported value for authMethod in the preferences. Returning
    // 'basic' as default.
    return 'basic'
  },
  set: function (value) {
    value = normalizeAuthMethod(value)
    Preferences.main().put('osm-server.auth-method', value)
  }
})

/**
 * Gets the credentials, i.e. username and password for the basic
 * authentication method.
 *
 * &lt;p>&lt;strong>Named options&lt;/strong>&lt;/p>
 *
 * &lt;dl>
 *    &lt;dt>&lt;code class='signature'>host:string&lt;/code>&lt;/dt>
 *    &lt;dd class="param-desc">The host name of the API server for which credentials are retrieved.
 *    If missing, the host name of the currently configured OSM API server
 *    is used.&lt;/dd>
 * &lt;/dl>
 *
 * @example
 * const { ApiConfig } = require('josm/api')
 *
 * // get username/password for the current OSM API server
 * const credentials = ApiConfig.getCredentials('basic')
 *
 * @param {string} authMethod  the authentication method. Either &lt;code>basic&lt;/code> or &lt;code>oauth&lt;/code>
 * @param {object} options  (optional) additional options (see above)
 * @static
 * @summary Gets the credentials.
 * @returns {object}  the credentials
 * @name getCredentials
 * @function
 * @memberof module:josm/api~ApiConfig
*/
exports.ApiConfig.getCredentials = function (authMethod, options) {
  const CredentialsManager = Java.type('org.openstreetmap.josm.io.auth.CredentialsManager')
  const OsmApi = Java.type('org.openstreetmap.josm.io.OsmApi')
  const RequestorType = Java.type('java.net.Authenticator.RequestorType')
  const String = Java.type('java.lang.String')

  options = options || {}
  util.assert(typeof options === 'object',
    'options: expected an object with named options, got {0}', options)

  function getBasicCredentials () {
    const cm = CredentialsManager.getInstance()
    if (options.host) options.host = util.trim(String(options.host))
    const host = options.host ? options.host : OsmApi.getOsmApi().getHost()
    const pa = cm.lookup(RequestorType.SERVER, host)
    return pa ? {
      host: host,
      user: pa.getUserName(),
      password: String.valueOf(pa.getPassword())
    } : {
      host: host,
      user: undefined,
      password: undefined
    }
  }

  function getOAuthCredentials () {
    const cm = CredentialsManager.getInstance()
    const token = cm.lookupOAuthAccessToken()
    if (token == null) return undefined
    return { key: token.getKey(), secret: token.getSecret() }
  }

  authMethod = normalizeAuthMethod(authMethod)
  if (authMethod === 'basic') return getBasicCredentials()
  if (authMethod === 'oauth') return getOAuthCredentials()
  util.assert(false, 'Unsupported authentication method, got {0}',
    authMethod)
}

function normalizeBasicCredentials (credentials) {
  const PasswordAuthentication = Java.type('java.net.PasswordAuthentication')

  if (util.isNothing(credentials)) return null
  util.assert(credentials instanceof PasswordAuthentication || typeof credentials === 'object',
    'basic credentials: expected an object or an instance of ' +
    'PasswordAuthentication , got {0}', credentials)

  if (credentials instanceof PasswordAuthentication) {
    return credentials
  } else {
    const user = String.valueOf(credentials.user || '')
    let password = credentials.password || null
    password = password
      ? String.valueOf(password).toCharArray()
      : password
    return new PasswordAuthentication(user, password)
  }
}

function normalizeOAuthCredentials (credentials) {
  const OAuthToken = Java.type('org.openstreetmap.josm.data.oauth.OAuthToken')
  if (util.isNothing(credentials)) return null
  util.assert(credentials instanceof OAuthToken || typeof credentials === 'object',
    'oauth credentials: expected an object or an instance of OAuthToken, ' +
    'got {0}', credentials)
  if (credentials instanceof OAuthToken) {
    return credentials
  } else {
    const key = String(credentials.key || '')
    const secret = String(credentials.secret || '')
    return new OAuthToken(key, secret)
  }
}

/**
 * Set the credentials, i.e. username and password for the basic
 * authentication method.
 *
 * Basic authentication credentials are either an instance of
 * java.net.PasswordAuthentication or
 * an object &lt;code>{user: string, password: string}&lt;/code>.
 *
 * OAuth authentication credentials are either an instance of
 * {@class org.openstreetmap.josm.data.oauth.OAuthToken} or
 * an object &lt;code>{key: string, secret: string}&lt;/code>.
 * &lt;p>
 * &lt;strong>Named options&lt;/strong>
 * &lt;/p>
 * &lt;dl>
 *    &lt;dt>&lt;code class='signature'>host:string&lt;/code>&lt;/dt>
 *    &lt;dd class="param-desc">The host name of the API server for which credentials are set.
 *    If missing, the host name of the currently configured OSM API server
 *    is used.&lt;/dd>
 * &lt;/dl>
 *
 * @example
 * const { ApiConfig } = require('josm/api')
 *
 * // set the credentials
 * ApiConfig.setCredentials('basic', { user:'test', password:'apassword' })
 *
 * @param {string} authMethod  the authentication method. Either 'basic' or 'oauth'.
 * @param {(object|org.openstreetmap.josm.data.oauth.OAuthToken|java.net.PasswordAuthentication)}
 *         credentials  the credentials.
 * @param {object} options  (optional) additional options (see above)
 * @function
 * @static
 * @summary Set the credentials.
 * @returns {object} the credentials
 * @name setCredentials
 * @memberof module:josm/api~ApiConfig
 */
exports.ApiConfig.setCredentials = function (authMethod, credentials, options) {
  const CredentialsManager = Java.type('org.openstreetmap.josm.io.auth.CredentialsManager')
  const RequestorType = Java.type('java.net.Authenticator.RequestorType')
  const OsmApi = Java.type('org.openstreetmap.josm.io.OsmApi')

  options = options || {}
  util.assert(typeof options === 'object',
    'options: expected an object with named options, got {0}', options)
  authMethod = normalizeAuthMethod(authMethod)
  if (authMethod === 'basic') {
    credentials = normalizeBasicCredentials(credentials)
    util.assert(credentials != null,
      'credentials: can\'\'t store null credentials')
    let host = options.host ? String(options.host) : null
    host = host || OsmApi.getOsmApi().getHost()
    const cm = CredentialsManager.getInstance()
    cm.store(RequestorType.SERVER, host, credentials)
  } else if (authMethod === 'oauth') {
    credentials = normalizeOAuthCredentials(credentials)
    util.assert(credentials != null,
      'credentials: can\'\'t store null credentials')
    const cm = CredentialsManager.getInstance()
    cm.storeOAuthAccessToken(credentials)
  } else {
    util.assert(false, 'Unsupported authentication method, got {0}',
      authMethod)
  }
}
</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


	<span class="copyright">
	© Contributors to the JOSM Scripting Plugin
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a>
	
		on Tue May 31st 2022
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
